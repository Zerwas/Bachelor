\section{An upper bound for the measure concentration function}
In this section we will prove Azema's inequality and as a consequence, we will obtain an upper bound for the measure concentration function. As the next results rely heavily on stochastic methods we will briefly introduce the necessary notions. Since the $G_n$ are all finite and equipped with the normalized counting measure we will only consider \define{probability spaces} $(X,\Sigma,\mu)$, where $X$ is finite, $\Sigma$ is a $\sigma$-algebra over $X$, and $\mu(A)=|A|/|X|$ for $A\subseteq X$. Most of the statements in this section hold in a more general setting \cite{azema}. Note that $\Sigma$ has a very nice representation.%Note that $\Sigma$ is the smallest $\sigma$-algebra containing $A_1,\dots,A_n$, where $$ 

\begin{lemma}
Let $\Sigma$ be a $\sigma$-algebra over a finite set $X$, then $\Sigma$ is the smallest $\sigma$-algebra containing the partition $A_1,\dots,A_n$, where the $A_i$'s are the minimal nonempty sets in $\Sigma$.
\end{lemma}
\begin{proof}
First we show that $A_1,\dots,A_n$ is a  partition of $X$. Since $A_i\cap A_j\in\Sigma$ we conclude, by minimality of $A_i$ and $A_j$, that either $i=j$ or $A_i\cap A_j=\emptyset$. Clearly, every element of $X$ is contained in a one of the $A_i$. 

For $A\in\Sigma$ we have, again by minimality, that $A\cap A_i$ is either $A_i$ or $\emptyset$. Therefore $A$ can be written as a union of $A_i$'s.
\end{proof}
Note that it follows from the proof that any $A\in\Sigma$ can be written as $\bigcup_{i\in I}A_i$ for a suitable $I$. This lemma allows us to use partitions and $\sigma$-algebras interchangeably. We will denote the partition corresponding to $\Sigma$ by $A_1,\dots,A_n$, for $\Sigma'$ we will use $A'_1,\dots,A'_{n'}$, etc. The next definition is simplified a lot by only considering finite $X$.

\begin{definition}
Let $(X,\Sigma,\mu)$ be a probability space, $f\colon X\to \R$ be a measurable function, and $\Sigma'$ be a sub-$\sigma$-algebra of $\Sigma$. Then the \define{conditional expectation} of $f$ with respect to $\Sigma'$ is defined as
\[\E(f\mid \Sigma'):=\sum_{i=1}^{n'}\E(f\mid A'_i)\cdot \mathbb{1}_{A'_i}.\]
\end{definition}

One often thinks of $\Sigma'$ as the available information, a finer partition means more information. The conditional expectation $\E(f\mid \Sigma')$ is the best approximation of $f$ given only the information from $\Sigma'$. 
With this intuition the statements from the following lemma are not surprising. 
\begin{lemma}\label{lem:condExp}
Let $(X,\Sigma,\mu)$ be a probability space, $f,g\colon X\to \R$ be measurable functions, $\Sigma''\subseteq\Sigma'\subseteq\Sigma$ be sub-$\sigma$-algebras. Then
\begin{enumerate}[label=\roman*)]
\item if $f\leq g$, then $\E(f\mid \Sigma')\leq\E(g\mid \Sigma')$,
\item for any $\Sigma'$-measurable function $h\colon X\to\R$ we have $\E(h f\mid\Sigma')=h\cdot\E(f\mid\Sigma')$,
\item also $\E(\E(f\mid \Sigma')\mid\Sigma'')=\E(f\mid\Sigma'')=\E(\E(f\mid \Sigma'')\mid\Sigma')$.
\end{enumerate}
\end{lemma}
\begin{proof}
To i): If $f\leq g$, then
\[\E(f\mid \Sigma')=\sum_{i=1}^n\E(f\mid A'_i)\cdot \mathbb{1}_{A'_i}\leq \sum_{i=1}^n\E(g\mid A'_i)\cdot \mathbb{1}_{A'_i}=\E(g\mid \Sigma').\]


To ii): Let $h\colon X\to\R$ be $\Sigma'$-measurable function, then $h=\sum_{i=1}^{n'}h_i\mathbb{1}_{A'_i}$. Now 
\begin{align*}
\E(h f\mid\Sigma')&=\sum_{i=1}^{n'}\E(hf\mid A'_i)\mathbb{1}_{A'_i}\\
&=\sum_{i=1}^{n'}h_i\E(f\mid A'_i)\mathbb{1}_{A'_i}\\
&=h\cdot\E(f\mid\Sigma').
\end{align*}

To iii): Note that $\E(\E(f\mid \Sigma')\mid A')=\E(f\mid A')$ for all $A'\in\Sigma'$.
\begin{align*}
\E(\E(f\mid \Sigma')\mid\Sigma'')&=\sum_{i=1}^{n''}\E(\E(f\mid \Sigma')\mid A''_i)\cdot\mathbb{1}_{A''_i}\\
&=\sum_{i=1}^{n''}\E(f\mid A''_i)\cdot\mathbb{1}_{A''_i}\tag{$A''_i\in\Sigma'$}\\
&=\E(f\mid\Sigma'')\\
&=\sum_{j=1}^{n''}\E(f\mid A''_j)\cdot\mathbb{1}_{A''_j}\cdot\sum_{i=1}^{n'}\mathbb{1}_{A'_i}\\
&=\sum_{i=1}^{n'}\sum_{j=1}^{n''}\E(\E(f\mid A''_j)\mid A'_i)\cdot\mathbb{1}_{A''_j}\cdot\mathbb{1}_{A'_i}\\
&=\sum_{i=1}^{n'}\sum_{j=1}^{n''}\E(\E(f\mid A''_j)\cdot\mathbb{1}_{A''_j}\mid A'_i)\cdot\mathbb{1}_{A'_i}\tag{by ii}\\
&=\E(\E(f\mid \Sigma'')\mid\Sigma')
\end{align*}


This concludes the proof.
\end{proof}


%\begin{definition}
%A \define{martingale} is a family $(f_i,\mathcal{F}_i)_{i\in \{0,\dots,n\}}$ such that
%\begin{itemize}
%\item $f_i$ is integrable for all $i\in \{0,\dots,n\}$,
%\item $f_i$ is $\mathcal{F}_i$ measurable for all $i\in \{0,\dots,n\}$, and
%\item $f_i=\mathbb{E}[f_{i+1}|\mathcal{F}_i]$ for all $i\in \{0,\dots,n-1\}$.
%\end{itemize}
%\end{definition}

The following lemma might not seem very interesting, but changing the exponent from $x$ to $x^2$ is the very foundation for Azema's inequality.
\begin{lemma}\label{lem:exToex2} For all $x\in\R$
\[e^{x}\leq x+e^{x^2}.\]
\end{lemma} 
\begin{proof}
Note that for $x=0$ both sides are equal to 1. As both sides are differentiable it suffices to show that the derivative of the right hand side is larger than the derivative of the left hand side for all $x\geq0$ and smaller for all $x\leq0$. Hence, we want to show
\begin{align*}
e^x\geq 1+2xe^{x^2}\text{ for all $x\leq 0$} &&\text{and}&& e^x\leq 1+2xe^{x^2}\text{ for all $x\geq 0$}.
\end{align*}
As for $x=0$ both sides are again equal to 1 we can reduce the problem, by similar reasoning, to the question whether
\[e^x\leq 2e^{x^2}+4x^2e^{x^2}\text{ for all $x\in\R$}.\]

\begin{itemize}
\item For $x=0$ the terms reduce to $1\leq2$.
\item For $x<0$ the left hand side is bounded by 1, while the right hand side is still larger that 2.
\item For $1\leq x$ we have $x\leq x^2$ and the inequality holds trivially.
\item For $0< x< 1$ note that the both sides are increasing. Hence the inequality holds for all $x$ with $e^x\leq 2$. Finally, $\ln2\geq\frac{1}{2}$ and therefore the right hand side with $x=\ln2$ evaluates to a number larger then $e$.  
\end{itemize}
\end{proof}

Before we will prove Azema's inequality let us introduce some useful notation. Whenever there is no danger of confusion we will abbreviate sets of the form
\begin{align*}
\{x\in X\mid \operatorname{Condition}(x)\text{ holds}\}&&\text{by}&&\{\operatorname{Condition}\}.
\end{align*}
For example $\{x\in X\mid f(x)= c\}$ becomes $\{f= c\}$.

\begin{lemma}\label{lem:azema}[Azema's inequality]
Let $(X,\Sigma,\mu)$ be a probability space, $f\colon X\to\R$ a measurable function, and $\{X\}=\Sigma_0\subseteq\dots\subseteq\Sigma_n=\Sigma$ a chain of sub-$\sigma$-algebras. Define $f_i:=\E(f\mid\Sigma_i)$ and $d_i:=f_i-f_{i-1}$. Then for every $\varepsilon\geq0$
%\[\mu(\{x\in X\mid |f(x)-\mathbb{E}(f)|\geq c\})\leq 2\exp\left(-\frac{c^2}{4\sum_{i=1}^{n}\|d_i\|^2_\infty}\right)\]
\[\mu(\{|f-\E(f)|\geq \varepsilon\})\leq 2\cdot\exp\left(-\frac{\varepsilon^2}{4\cdot\sum_{i=1}^{n}\|d_i\|^2_\infty}\right).\]
\end{lemma}
Note that $(f_i,\Sigma_i)_{0\leq i\leq n}$ is a discrete martingale. 
\begin{proof} First, observe that $f_0=\E(f\mid \{X\})=\E(f)$ and $f_n=\E(f\mid\Sigma)=f$. Using a simple telescoping sum we obtain $f-\E(f)=d_1+\dots+d_n$. Therefore
\begin{align*}
\mu(\{f-\E(f)\geq \varepsilon\})&=\mu(\{\sum_{i=1}^{n}d_i\geq  \varepsilon\})\\
&=\mu(\{\lambda\cdot\sum_{i=1}^{n}d_i\geq \lambda \varepsilon\})\tag{for $\lambda>0$}\\
&=\mu(\{e^{\lambda\cdot\sum_{i=1}^{n}d_i-\lambda \varepsilon}\geq 1\})\\
&\leq\E(e^{\lambda\cdot\sum_{i=1}^{n}d_i})\cdot e^{-\lambda \varepsilon}\tag{$\ast$}\\
&=\E(e^{\lambda d_1}\cdot\ldots\cdot e^{\lambda d_{n-1}}\cdot\E(e^{\lambda d_n}\mid \Sigma_{n-1}))\cdot e^{-\lambda \varepsilon}\tag{Lemma \ref{lem:condExp}}\\
&\leq\E(e^{\lambda d_1}\cdot\ldots\cdot e^{\lambda d_{n-1}})\cdot e^{\lambda^2\cdot \|d_n\|^2_\infty}\cdot e^{-\lambda \varepsilon}\tag{$\ast\ast$}\\
&\hspace{3cm}\vdots\\
&\leq e^{\lambda^2\cdot \|d_1\|^2_\infty}\cdot\ldots\cdot e^{\lambda^2\cdot \|d_{n-1}\|^2_\infty}\cdot e^{\lambda^2\cdot \|d_n\|^2_\infty}\cdot e^{-\lambda \varepsilon}\\
&=e^{\lambda^2\cdot\sum_{i=1}^n\|d_i\|^2_\infty-\lambda \varepsilon}.
\end{align*}

For $(\ast)$ note that for any measurable function $g\colon X\to\R$ with $g\geq0$ we have %$\mu(\{g\geq1\})\leq\E(g)$.
\[\mu(\{g\geq1\})=\E(\mathbb{1}_{\{g\geq1\}})\leq\E(g).\]

For $(\ast\ast)$ we need to use Lemma \ref{lem:exToex2}
\begin{align*}
\E(e^{\lambda d_i}\mid \Sigma_{i-1})&\leq \E(\lambda d_i\mid\Sigma_{i-1})+\E(e^{\lambda^2 d^2_i}\mid\Sigma_{i-1})\\
&=\lambda\cdot\E( f_i-f_{i-1}\mid\Sigma_{i-1}) + \E(e^{\lambda^2 d^2_i}\mid\Sigma_{i-1})\\
&\leq 0 + e^{\lambda^2 \|d_i\|_\infty^2}.\tag{Lemma \ref{lem:condExp}}
\end{align*}

Substituting $-\frac{\varepsilon^2}{\sum_{i=1}^{n}\|d_i\|_\infty^2}$ for $\lambda$ we conclude that
\[\mu(\{f-\mathbb{E}(f)\geq \varepsilon\})\leq\exp\left(-\frac{\varepsilon^2}{4\cdot\sum_{i=1}^{n}\|d_i\|^2_\infty}\right). \]
The same calculations with $-d_i$ instead of $d_i$ yield the dual inequality
\[\mu(\{f-\mathbb{E}(f)\leq -\varepsilon\})\leq\exp\left(-\frac{\varepsilon^2}{4\cdot\sum_{i=1}^{n}\|d_i\|^2_\infty}\right). \]
These two statements obviously give us the desired result.
\end{proof}

Since $\mu$ is the counting measure Azema's inequality bounds the number of elements for which $f$ differs more than $\varepsilon$ from its mean. This seems at least somewhat connected to the measure concentration function, as there we want to show that for any set $A$ with $\mu(A)\geq\frac{1}{2}$ only a few elements are more than $\varepsilon$ away from $A$.
The next goal is to formalize this connection % Azema's inequality with the measure concentration function. 
To achieve this we first need to introduce a new property of mm-spaces.
\begin{definition}\label{def:length}
Let $\boldsymbol{X}=(X,d,\mu)$ be a finite mm-space. The \define{length} of $\boldsymbol X$ is the minimum over all $l$ with the following property. There is a refining sequence of partitions 
\[\{X\}=\Omega_0\prec\dots\prec\Omega_n=\{\{x\}\mid x\in X\},\]
where for every $i\in\{1,\dots,n\}$ there is an $a_i$ such that $\sum_{i=1}^{n}a^2_i=l^2$ and for every $A\in \Omega_{i-1}$, $x,y\in A$ there is an isomorphism (of metric spaces) $\phi\colon[x]_i\to [y]_i$ with 
\[d(z,\phi(z))\leq a_i\text{ for all $z\in[x]_i$.}\]
\end{definition}

Note that since $\mu$ is the counting measure $\phi$ is also an isomorphism of mm-spaces.
As this definition is quite hard we will look at some properties and examples of the length of $\boldsymbol{X}$ before proceeding.
\begin{lemma}
Let $\boldsymbol{X}$ be a finite mm-space. Then the length of $\boldsymbol{X}$ is at most the diameter of $\boldsymbol{X}$.
\end{lemma}
\begin{proof}
Consider only the two partitions $\{X\}\prec\{\{x\}\mid x\in X\}$.
\end{proof}

\begin{example}
Let us look at the $n$-dimensional cube $X_n=\{0,1\}^n$.

\begin{center}
\tikzstyle{dot}=[circle,draw,minimum size=0.8mm,inner sep=0pt,fill]
\begin{tikzpicture}
\node[dot] at (0,0) (11) {};
\node[dot, right of = 11] (12) {};
\node at (0.5,-0.5) {$X_1$};

\node[dot] at (3,0) (21) {};
\node[dot, right of = 21] (22) {};
\node[dot, above of = 22] (23) {};
\node[dot, above of = 21] (24) {};
\node at (3.5,-0.5) {$X_2$};

\node[dot] at (6,0) (31) {};
\node[dot, right of = 31] (32) {};
\node[dot, above of = 32] (33) {};
\node[dot, above of = 31] (34) {};
\node[dot] at (6.5,0.5) (41) {};
\node[dot, right of = 41] (42) {};
\node[dot, above of = 42] (43) {};
\node[dot, above of = 41] (44) {};
\node at (6.5,-0.5) {$X_3$};

\path (11) edge (12)
      (21) edge (22)
      (22) edge (23)
      (23) edge (24)
      (24) edge (21)
      (31) edge (32)
      (32) edge (33)
      (33) edge (34)
      (34) edge (31)
      (41) edge (42)
      (42) edge (43)
      (43) edge (44)
      (44) edge (41)
      (31) edge (41)
      (32) edge (42)
      (33) edge (43)
      (34) edge (44);

\end{tikzpicture}
\end{center}
We will only consider the following sequence of partitions
\[\Omega_0\prec\dots\prec\Omega_n\text{ with }\Omega_i=\{wX_{n-i}\mid w\in\{0,1\}^i\}.\]

First, we equip $X_n$ with the euclidean metric and rescale it such that the diameter is 1. To bound the length of the resulting space $\boldsymbol X^E_n$ consider $[x]_i\neq[y]_i$. Note that $x$ and $y$ are w.l.o.g. of the form $w0u$ and $w1v$ for some $w\in\{0,1\}^{i-1}$, $u,v\in\{0,1\}^{n-i}$. The isomorphism $\phi$ takes an element $w0u'$ in $[x]_i$ and maps it to $w1u'$. The length of a side in $\boldsymbol X^E_n$ is $\frac{1}{\sqrt{n}}$, hence every $a_i$ is $\frac{1}{\sqrt{n}}$ for every $i$ and the length of $\boldsymbol{X}^E_n$ is bounded by $(\sum_{i=1}^{n}\frac{1}{\sqrt{n}^2})^{\frac{1}{2}}=1$.

Secondly, we use the hemming metric and obtain the mm-space $\boldsymbol{X}^H_n$ with diameter 1. It has side length $\frac{1}{n}$ and therefore the length of $\boldsymbol{X}^H_n$ is bounded by $(\sum_{i=1}^{n}\frac{1}{n^2})^{\frac{1}{2}}=n^{-\frac{1}{2}}$. We see that here the length of $\boldsymbol{X}^H_n$ converges to 0 as $n$ tends to infinity. We will show that this means that the measure concentration function $\alpha_{\boldsymbol{X}^H_n}(r)$ also goes to 0 for any fixed $r>0$. 
\end{example}



\begin{lemma}\label{lem:lipschitz}
Let $\boldsymbol{X}=(X,d,\mu)$ be a finite mm-space of length $l$ and $f\colon X\to\R$ be a 1-Lipschitz function. Then
\[\mu(\{|f-\E(f)|\geq\varepsilon\})\leq 2\exp\left(-\frac{\varepsilon^2}{4l^2}\right)\text{ for every $\varepsilon>0$.}\] 
\end{lemma}
\begin{proof}
Let 
$\Omega_0\prec\dots\prec\Omega_n$
be a refining sequence of partitions with $a_1,\dots,a_n$ as in Definition \ref{def:length} such that $\sum_{i=1}^{n}a_i^2=l^2$. These partitions correspond to $\sigma$-algebras $\Sigma_0\subseteq\dots\subseteq\Sigma_n$. Now we can apply Azema's inequality to obtain
\[\mu(\{|f-\E(f)|\geq \varepsilon\})\leq 2\cdot\exp\left(-\frac{\varepsilon^2}{4\cdot\sum_{i=1}^{n}\|d_i\|^2_\infty}\right),\]
where $f_i=\E(f\mid \Sigma_i)$ and $d_i=f_i-f_{i-1}$ as before. Therefore we only need to show that $\|d_i\|_\infty\leq a_i$. Since on any $A\in\Omega_{i-1}$ we have $f_{i-1}=\E(f_i\mid A)$ it suffices to show that for all $A\in\Omega_{i-1}$ it holds that $f_i(x)-f_i(y)\leq a_i$ for all $x,y\in A$.
Let $\phi\colon [x]_i\to [y]_i$ be the isomorphism from Definition \ref{def:length}.
\begin{align*}
f_i(x)-f_i(y)&=\E(f\mid [x]_i)-\E(f\mid [y]_i)\\
&=\E(f\mid [x]_i)-\E(f\circ\phi\mid [x]_i)\\
&=\E(f-f\circ\phi\mid [x]_i)\\
&\leq \E(d(\ .\ ,\phi(\ .\ ))\mid [x]_i)\tag{$f$ is 1-Lipschitz}\\
&\leq a_i
\end{align*}
This concludes the proof.
\end{proof}

Let $\boldsymbol{X}=(X,d,\mu)$ be a finite mm-space and $A\subseteq X$ measurable. Observe that $d_A\colon X\to\R$, $d_A(x):=\inf_{y\in A}d(x,y)$ is a 1-Lipschitz function. Using this we can rewrite the definition of the measure concentration function 
\[\alpha_{\boldsymbol{X}}(\varepsilon)=\sup\{\mu(\{d_A\geq\varepsilon\})\mid \mu(A)\geq\frac{1}{2}\}.\]
This gives us the desired connection.
%\FlorianSagt{$n$ dimensional cubes with diameter 1 have length $\frac{1}{\sqrt{3}}$ and if $|X|$ is a prime, then the length of $X$ is equal to its diameter, the length of a circle is the same as its diameter}

%Between any two points in $X$ there is almost surely a path $x_0,\dots,x_n$ such that \[\sum_{i=1}^n d(x_{i-1},x_i)^2\leq \operatorname{len}(X)^2\] (this path probably has some special properties).

\begin{theorem}\label{thm:measureConcetration}
If a finite mm-space $\boldsymbol{X}=(X,d,\mu)$ has length $l$, then the measure concentration function of $\boldsymbol X$ satisfies
\[\alpha_{\boldsymbol{X}}(\varepsilon)\leq 2\exp\left(-\frac{\varepsilon^2}{16l^2}\right)\text{ for all $\varepsilon>0$}.\]
\end{theorem}
\begin{proof}
Let $\varepsilon>0$ and $A\subseteq X$ be measurable with $\mu(A)\geq\frac{1}{2}$. As mentioned above $d_A$ is 1-Lipschitz and therefore, by Lemma \ref{lem:lipschitz},

\[\mu(\{|d_A-\E(d_A)|\geq\varepsilon\})\leq 2\exp\left(-\frac{\varepsilon^2}{4l^2}\right).\]
Now there are two cases to consider, the first case is the more interesting one.

If $\E(d_A)\leq\varepsilon$, then for any $x$ with $d_A(x)\geq2\varepsilon$ we know $d_A(x)\geq \varepsilon+\E(d_A)$ and therefore $|d_A(x)-\E(d_A)|\geq \varepsilon$. As a consequence %then for any $x$ with $|d_A(x)-\E(d_A)|<\varepsilon$ we have, by non-negativity of $d_A$, that $d_A(x)-\E(d_A)<\varepsilon$. Hence $d_A(x)<2\varepsilon$ and in general 
\[\mu(\{d_A\geq2\varepsilon\})\leq \mu(\{|d_A-\E(d_A)|\geq\varepsilon\})\leq2\exp\left(-\frac{\varepsilon^2}{4l^2}\right) .\]
Replacing $\varepsilon$ by $\frac{\varepsilon}{2}$ gives the desired inequality.

If $\E(d_A)>\varepsilon$, then $A\subseteq \{|d_A-\E(d_A)|\geq\varepsilon\}$. Consequently,
\[\mu(\{d_A\geq\varepsilon\})\leq \mu(X\setminus A)\leq \frac{1}{2}\leq \mu(A)\leq \mu(\{|d_A-\E(d_A)|\geq\varepsilon\})\leq 2\exp\left(-\frac{\varepsilon^2}{4l^2}\right).\]
This proves the theorem.
\end{proof}
Note that in the second case the upper bound is at least $\frac{1}{2}$, which means that if $l$ is large enough then we are in the first case and the expected distance to a set with at least half measure is less then $\varepsilon$. 
Our goal is to apply Theorem to groups and as it turns out we can bound the length of a group using sequences of subgroups. Before we can write down the corollary we need to make a quick excursion to factor metrics. 

\begin{definition}
Let $(X,d)$ be a metric space and let $\sim$ be an equivalence relation on $X$. Then \[d_\sim([x],[y])=\inf\{d(p_1,q_1)+\dots+d(p_n,q_n)\mid q_i\sim p_{i+1}, x\sim p_1, q_n\sim y\}\] defines a pseudometric on $X/{\sim}$.
\end{definition}

In case that $X$ is a group with bi-invariant metric this definition simplifies.
\begin{lemma}\label{lem:factorMetric}
Let $G$ be a finite group with bi invariant metric $d$ and $H$ a (not necessarily normal) subgroup of $G$. Then the factor metric $d_H$ on $G/H=\{gH\mid g\in G\}$ is a proper metric and satisfies $d_H(gH,g'H)=\inf\{d(g,g'h)\mid h\in H\}$.
\end{lemma}
\begin{proof}
Let $x,y\in G$. We show that for any path $p_1,q_1,\dots,p_n,q_n$ as in the definition there are $x\sim p$ and $q\sim y$ such that $d(p,q)\leq d(p_1,q_1)+\dots+d(p_n,q_n)$. It suffices to show this for $n=2$. 
By definition $p_1,q_1,p_2,q_2$ are of the form $g,g',g'h,g''$ form some $g,g',g''\in G$ and $h\in H$. Since $d$ is bi-invariant 
\[d(gh,g'')\leq d(gh,g'h)+d(g'h,g'')=d(g,g')+d(g'h,g'').\]
Furthermore we are given that $G$ is finite. Hence the infimum becomes a minimum and $d_H([x],[y])=0$ only if $[x]=[y]$.
%$d(g,g')=d(gh,g'h)$.
\end{proof}

Equipped with this knowledge we can formulate the final statement for this section. 
\begin{corollary}\label{cor:meaContractionGroups}
Let $G$ be a finite group with a bi-invariant metric $d$, and let
\[\{e\}=G_0<G_1<\dots <G_n=G\]
be a chain of subgroups. Denote the diameter of $G_i/G_{i-1}$ with respect to the factor metric by $a_i$. Then the measure concentration function of the mm-space $(G,d,\mu)$, where $\mu$ is the normalized counting measure, satisfies
\[\alpha_{\boldsymbol{X}}(\varepsilon)\leq 2\exp\left(-\frac{\varepsilon^2}{16\cdot\sum_{i=1}^{n}a_i^2}\right).\]
\end{corollary}
\begin{proof}
We show that the length $l$ of $(G,d,\mu)$ is bounded by $\left(\sum_{i=1}^{n}a_i^2\right)^{\frac{1}{2}}$ and apply Theorem \ref{thm:measureConcetration}. Define the sequence of partitions $\Omega_i:=\{g G_i\mid g\in G\}$
\begin{align*}
\{\{g\}\mid g\in G\}=\Omega_0\succ\Omega_1\succ&\dots\succ\Omega_n=\{G\}\\
\{e\}=\parbox{\widthof{$\Omega_0\succ\Omega_1\succ$}}{$G_0<G_1<$}&\parbox{\widthof{${}\dots\succ\Omega_n$}}{$\dots <G_n$}=G.
\end{align*}
Take $A\in \Omega_{i+1}$ and $g,g'\in A$. Since the distance of $gG_i$ and $g'G_i$ with respect to the factor metric is at most $a_i$ there is an $h'\in G_i$ such that $d(g,g'h')\leq a_i$. Hence the map 
\begin{align*}
\phi\colon g G_i&{}\to g'G_i\\
gh&{}\mapsto g'h'h
\end{align*}
is, by bi-invariance of $d$, an isomorphism of metric spaces with $d(gh,g'h'h)=d(g,g'h')\leq a_i$ for all $gh\in gG_i$.
Therefore $\left(\sum_{i=1}^{n}a_i^2\right)$ is an upper bound for $l^2$. 
\end{proof}
Carderi and Thom used this result to show that the limit of $\SL_{2^n}(q)$ is extremely amenable \cite{thom}. We will recreate this proof in the next section. 


\section{The limit of $\SL_{2^n}(q)$ is extremely amenable}\label{sec:thom}

When studying matrices it is often useful to look at the corresponding linear maps of a suitable vector space. 
In the case of $\SL_n(q)$ an $n$ dimensional $\F_q$ vector space $V$ suffices. Fixing a basis $e_1,\dots,e_n$ gives us an embedding from $\SL_n(q)$ into $\Aut(V)$. Next we will apply the methods from the previous section to show that $\clim \SL_{2^n}(q)$ is extremely amenable.
%rank from 2 to 3 in proof
\begin{theorem}\label{thm:SLConcentrates}
The normalized counting measure on the groups $\SL_{n}(q)$ concentrates with respect to the normalized rank-metric, i.e. for all $\varepsilon>0$
\[\lim_{n\to\infty} \alpha_{(\SL_{n}(q), d, \mu)}(\varepsilon)=0 .\]\FlorianSagt{Boldsymbol or tuple}
\end{theorem}
\begin{proof}\FlorianSagt{proof for $\SL$ and $\GL$ te same?}
We will apply Corollary \ref{cor:meaContractionGroups} to a sequence of subgroups which also shows that the length of  $\SL_n(q)$ is bounded by $3n^{-\frac{1}{2}}$.
Let $e_1,\dots,e_n$ be a basis of an $n$ dimensional $\F_q$ vector space $V$. Look at the sequence
\[\SL_0(q)<\SL_1(q)<\dots<\SL_n(q),\]
where $\SL_{i-1}(q)$ becomes a subgroup of $\SL_i(q)$ via the embedding $g\mapsto 
\begin{pmatrix}
g&0\\
0&1
\end{pmatrix}$. Next we want to bound the diameter of $\SL_{i}(q)/\SL_{i-1}(q)$ by $\frac{3}{n}$. By Lemma \ref{lem:factorMetric} it suffices to show that for any $g,g'\in\SL_i(q)$ there is an $h\in \SL_{i-1}(q)$ such that $d(g,g'h)\leq\frac{3}{n}$. Since $d$ is bi-invariant we can assume w.l.o.g. that $g'=1_V$. 
Our goal is now to find a $g'\in\SL_i(q)$ that is the identity on $e_i$.

Take a closer look at $ge_i$. If $e_i$ is an eigenvector of $g$ with eigenvalue $\lambda$, then $\lambda\not=0$ and $g$ is of the form 
$\begin{pmatrix}
A&0\\
c^\bot&\lambda
\end{pmatrix}$.
Define $h':=
\begin{pmatrix}
\lambda&0\\
0&\lambda^{-1}
\end{pmatrix}
$
and $g':=
\begin{pmatrix}
I_{i-2}&0\\
0&h'
\end{pmatrix}\cdot g$.
By construction $g'\in\SL_i(q)$ and it is of the form 
$\begin{pmatrix}
A'&0\\
c'^\bot&1
\end{pmatrix}$. Since $\det g'=1$ we have that $\det A'=1$ and therefore $A'\in\SL_{i-1}(q)$ making it a suitable candidate for $h$. Using the triangle inequality we obtain
\begin{align*}
d(g,h)&\leq d(g,g')+d(g',h)\\
&=d(I_i,\begin{pmatrix}
I_{i-2}&0\\
0&h'
\end{pmatrix})+\frac{1}{n}\rank(\begin{pmatrix}
0&0\\
-c'^\bot&0
\end{pmatrix})\\
&\leq \frac{2}{n}+ \frac{1}{n}
\end{align*}
as desired.

If $e_i$ is not an eigenvector of $g$, then we can make a change of basis of $\langle e_1,\dots,e_{i-1}\rangle$ such that $ge_i=e_{i-1}+\lambda e_i$. Henceforth we can assume w.l.o.g. that $g$ is of the form 
$\begin{pmatrix}
&&0\\
\multicolumn{2}{c}
      {\raisebox{\dimexpr\normalbaselineskip+.2\ht\strutbox-0.9\height}[0pt][0pt]
        {\scalebox{2.3}{$A$}}} &1\\
c^\bot&c_{i-1}&\lambda
\end{pmatrix}
$.
Define $h':=
\begin{pmatrix}
\lambda&-1\\
1&0
\end{pmatrix}
$ and as before $g':=
\begin{pmatrix}
I_{i-2}&0\\
0&h'
\end{pmatrix}\cdot g$.
Now we can apply the argument from above to get an $h\in \SL_{i-1}(q)$ such that $d(g,h)\leq\frac{3}{n}$. Applying Corollary \ref{cor:meaContractionGroups} we obtain
\[\alpha_{(\SL_n(q), d, \mu)}(\varepsilon)\leq 2\exp\left(-\frac{\varepsilon^2}{16\cdot\sum_{i=1}^{n}\frac{9}{n^2}}\right)=2\exp\left(-\frac{\varepsilon^2 n}{16\cdot9}\right),\]
which tends to 0 as $n$ goes to infinity. 

\end{proof}

From this theorem the main result of this section easily follows.

\begin{corollary}
The Polish group $\clim \SL_{2^n}(q)$ is extremely amenable.
\end{corollary}
\begin{proof}
Theorem \ref{thm:SLConcentrates} implies that $\clim \SL_{2^n}(q)$ is a Levy group and is therefore extremely amenable, by Theorem \ref{thm:LevyImpliesExAm}.
\end{proof}

As a byproduct we found an upper bound for the length of $\SL_n(q)$. We now ask how good this upper bound is. Therefore we our next goal is to determining also a lower bound. This part is not essential to the rest of the thesis but still interesting.

\begin{lemma}\label{lem:diamLen}
Let $(X,d,\mu)$ be a finite mm-space with diameter $\Delta$ and %\FlorianSagt{could be that this only holds for finite $X$ as conditions in definition of length are just almost surely}
\[\Omega_0=\{X\}\prec\dots\prec\Omega_n=\{\{x\}\mid x\in X\}\]
with $a_1,\dots,a_n$ as in Definition \ref{def:length}. Then 
\[\sum_{i=1}^{n}a_i\geq \Delta.\]
\end{lemma}
\begin{proof}
Let $x,y\in X$, with $x\neq y$, we show $d(x,y)\leq\sum_{i=1}^{n}a_i$. Let $i_0$ be the smallest number such that $[x]_{i_0}\neq [y]_{i_0}$. Since $[x]_0=X=[y]_0$ we know that $i_0$ is at least 1. Therefore $[x]_{i_0-1}=[y]_{i_0-1}$ and there is an isomorphism $\varphi_{i_0}\colon[x]_{i_0}\to[y]_{i_0}$ such that $d(\varphi_{i_0}(x),y)\leq a_{i_0}$. %\FlorianSagt{here is the a.s. problem} 
Let $x_{i_0}=\varphi_{i_0}(x)$, then 
\[d(x,y)\leq d(x,x_{i_0})+d(x_{i_0},y).\]
If $x_{i_0}=y$, then we are done. Otherwise let $i_1$ be the smallest number such that $[x_{i_0}]_{i_1}\neq [y]_{i_1}$. Then let $\varphi_{i_1}\colon[x_{i_0}]_{i_1}\to[y]_{i_1}$ be an isomorphism such that $d(\varphi_{i_1}(x_{i_0}),y)\leq a_{i_1}$. Define $x_{i_1}=\varphi_{i_1}(x_{i_0})$. Proceeding in this fashion yields elements $x_{i_0},\dots,x_{i_k}$ such that $x_{i_k}=y$ and
\[d(x,y)\leq d(x,x_{i_0})+d(x_{i_0},x_{i_1})+\dots+d(x_{i_{k-1}},x_{i_k})\leq a_{i_0}+\dots +a_{i_k}\leq\sum_{i=1}^{n}a_i.\]
From this the claim immediately follows.
\end{proof}


\begin{lemma}
Let $(X,d,\mu)$ be a finite mm-space with diameter $\Delta$ and $\delta=\min_{x\not=x} d(x,y)$. Then the length of $X$ is at least $(\Delta\cdot\delta)^{\frac{1}{2}}$.
\end{lemma}
\begin{proof}
We show by induction on $n$ that for any nonnegative $a_1,\dots, a_n$ with $\delta=\min_{1\leq i\leq n} a_i$ we have
\[\sum_{i=1}^{n}a_i\geq \Delta\implies \sum_{i=1}^{n}a_i^2\geq \Delta\cdot\delta.\]

For $n=1$: Note that $\Delta\geq\delta$. Hence 
\[\sum_{i=1}^{n}a_i^2=a_1^2=\delta^2\geq \Delta\cdot \delta.\]

For $n>1$: Assume w.l.o.g. that $a_1\leq\dots\leq a_n$. Then 
\begin{align*}
&\sum_{i=1}^{n}a_i\geq \Delta\\
\implies &\sum_{i=2}^{n}a_i\geq \Delta-\delta\tag{$a_1=\delta$}\\
\stackrel{\text{I.H.}}\implies &\sum_{i=2}^{n}a_i^2\geq (\Delta-\delta)\cdot \delta'\tag{with $\delta'=a_2$}\\
\implies &\sum_{i=2}^{n}a_i^2\geq \Delta\cdot\delta-\delta^2\tag{$\delta\leq\delta'$}\\
\implies &\sum_{i=1}^{n}a_i^2\geq \Delta\cdot\delta\tag{$a_1^2=\delta^2$}.
\end{align*}

From this claim together with Lemma \ref{lem:diamLen} the lemma immediately follows.

\end{proof}

Using this we can give an interval for the length of $\SL_n(q)$.

\begin{corollary}
Consider $(\SL_{n}(q),d,\mu)$, where $d$ is the normalized rank-metric and $\mu$ is the normalized counting measure. Then the length $l$ of this mm-space satisfies
\[n^{-\frac{1}{2}}\leq l\leq 3n^{-\frac{1}{2}}.\]
\end{corollary}
\begin{proof}
The diameter of $\SL_n(q)$ is equal to 1 and for any $g\not=g'\in\SL_n(q)$ we have $d(g,g')\geq \frac1n$.
\end{proof}

The next goal is to show that limits of symplectic groups are also extremely amenable. Theses groups can be seen as automorphism groups of a vector space together with a symplectic form. The proof will be similar to the one for the special linear groups but extending the partial inverse $h'$ becomes much harder. This is why in the next section we will prove Witt's Lemma which does exactly what we need, i.e. extending isometries.
