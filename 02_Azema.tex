\section{An upper bound for the measure concentration function}
In this section we will prove Azema's inequality and as a consequence, we will obtain an upper bound for the measure concentration function. As the next results rely heavily on stochastic methods we will briefly introduce the necessary notions. Since the $G_n$ are all finite and equipped with the normalized counting measure we will only consider \define{probability spaces} $(X,\Sigma,\mu)$, where $X$ is finite, $\Sigma$ is a $\sigma$-algebra over $X$, and $\mu(A)=|A|/|X|$ for $A\subseteq X$. For a more general approach see \cite{azema}. Note that $\Sigma$ has a very nice representation.%Note that $\Sigma$ is the smallest $\sigma$-algebra containing $A_1,\dots,A_n$, where $$ 

\begin{lemma}
Let $\Sigma$ be a $\sigma$-algebra over a finite set $X$, then $\Sigma$ is the smallest $\sigma$-algebra containing the partition $A_1,\dots,A_n$, where the $A_i$'s are the minimal nonempty sets in $\Sigma$.
\end{lemma}
\begin{proof}
First we show that $A_1,\dots,A_n$ is a  partition of $X$. Since $A_i\cap A_j\in\Sigma$ we conclude, by minimality of $A_i$ and $A_j$, that either $i=j$ or $A_i\cap A_j=\emptyset$. Clearly, every element of $X$ is contained in a one of the $A_i$. 

For $A\in\Sigma$ we have, again by minimality, that $A\cap A_i$ is either $A_i$ or $\emptyset$. Therefore $A$ can be written as a union of $A_i$'s.
\end{proof}
Note that it follows from the proof that any $A\in\Sigma$ can be written as $\bigcup_{i\in I}A_i$ for a suitable $I$. This lemma allows us to use partitions and $\sigma$-algebras interchangeably. We will denote the partition corresponding to $\Sigma$ by $A_1,\dots,A_n$, for $\Sigma'$ we will use $A'_1,\dots,A'_{n'}$, etc. The next definition is simplified a lot by only considering finite $X$.

\begin{definition}
Let $(X,\Sigma,\mu)$ be a probability space, $f\colon X\to \R$ be a measurable function, and $\Sigma'$ be a sub-$\sigma$-algebra of $\Sigma$. Then the \define{conditional expectation} of $f$ with respect to $\Sigma'$ is defined as
\[\E(f\mid \Sigma'):=\sum_{i=1}^{n'}\E(f\mid A'_i)\cdot \mathbb{1}_{A'_i}.\]
\end{definition}

One often thinks of $\Sigma'$ as the available information, a finer partition means more information. The conditional expectation $\E(f\mid \Sigma')$ is the best approximation of $f$ given only the information from $\Sigma'$. 
With this intuition the statements from the following lemma are not surprising. 
\begin{lemma}
Let $(X,\Sigma,\mu)$ be a probability space, $f,g$ be measurable functions, $\Sigma''\subseteq\Sigma'\subseteq\Sigma$ be sub-$\sigma$-algebras. Then
\begin{enumerate}[label=\roman*)]
\item if $f\leq g$, then $\E(f\mid \Sigma')\leq\E(g\mid \Sigma')$,
\item also $\E(\E(f\mid \Sigma')\mid\Sigma'')=\E(f\mid\Sigma'')=\E(\E(f\mid \Sigma'')\mid\Sigma')$, and
\item for any $\Sigma'$-measurable function $h\colon X\to\R$ we have $\E(h f\mid\Sigma')=h\cdot\E(f\mid\Sigma')$.
\end{enumerate}
\end{lemma}
\begin{proof}
To i): If $f\leq g$, then
\[\E(f\mid \Sigma')=\sum_{i=1}^n\E(f\mid A'_i)\cdot \mathbb{1}_{A'_i}\leq \sum_{i=1}^n\E(g\mid A'_i)\cdot \mathbb{1}_{A'_i}=\E(g\mid \Sigma').\]


To ii): Let $h\colon X\to\R$ be $\Sigma'$-measurable function, then $h=\sum_{i=1}^{n'}h_i\mathbb{1}_{A'_i}$. Now 
\begin{align*}
\E(h f\mid\Sigma')&=\sum_{i=1}^{n'}\E(hf\mid A'_i)\mathbb{1}_{A'_i}\\
&=\sum_{i=1}^{n'}h_i\E(f\mid A'_i)\mathbb{1}_{A'_i}\\
&=h\cdot\E(f\mid\Sigma').
\end{align*}

To iii): Note that $\E(\E(f\mid \Sigma')\mid A')=\E(f\mid A')$ for all $A'\in\Sigma'$.
\begin{align*}
\E(\E(f\mid \Sigma')\mid\Sigma'')&=\sum_{i=1}^{n''}\E(\E(f\mid \Sigma')\mid A''_i)\cdot\mathbb{1}_{A''_i}\\
&=\sum_{i=1}^{n''}\E(f\mid A''_i)\cdot\mathbb{1}_{A''_i}\tag{$A''_i\in\Sigma'$}\\
&=\E(f\mid\Sigma'')\\
&=\sum_{j=1}^{n''}\E(f\mid A''_j)\cdot\mathbb{1}_{A''_j}\cdot\sum_{i=1}^{n'}\mathbb{1}_{A'_i}\\
&=\sum_{i=1}^{n'}\sum_{j=1}^{n''}\E(\E(f\mid A''_j)\mid A'_i)\cdot\mathbb{1}_{A''_j}\cdot\mathbb{1}_{A'_i}\\
&=\sum_{i=1}^{n'}\sum_{j=1}^{n''}\E(\E(f\mid A''_j)\cdot\mathbb{1}_{A''_j}\mid A'_i)\cdot\mathbb{1}_{A'_i}\tag{by ii}\\
&=\E(\E(f\mid \Sigma'')\mid\Sigma')
\end{align*}


This concludes the proof.
\end{proof}


%\begin{definition}
%A \define{martingale} is a family $(f_i,\mathcal{F}_i)_{i\in \{0,\dots,n\}}$ such that
%\begin{itemize}
%\item $f_i$ is integrable for all $i\in \{0,\dots,n\}$,
%\item $f_i$ is $\mathcal{F}_i$ measurable for all $i\in \{0,\dots,n\}$, and
%\item $f_i=\mathbb{E}[f_{i+1}|\mathcal{F}_i]$ for all $i\in \{0,\dots,n-1\}$.
%\end{itemize}
%\end{definition}

The following lemma might not seem very interesting, but changing the exponent from $x$ to $x^2$ is the very foundation for Azema's inequality.
\begin{lemma} For all $x\in\R$
\[e^{x}\leq x+e^{x^2}.\]
\end{lemma} 
\begin{proof}
Note that for $x=0$ both sides are equal to 1. As both sides are differentiable it suffices to show that the derivative of the right hand side is larger than the derivative of the left hand side for all $x\geq0$ and smaller for all $x\leq0$. Hence
\begin{align*}
e^x\geq 1+2xe^{x^2}\text{ for all $x\leq 0$} &&\text{and}&& e^x\leq 1+2xe^{x^2}\text{ for all $x\geq 0$}.
\end{align*}
As for $x=0$ both sides are again equal to 1 we can reduce the problem by similar reasoning to the question whether
\[e^x\leq 2e^{x^2}+4x^2e^{x^2}\text{ for all $x\in\R$}.\]

\begin{itemize}
\item For $x=0$ the the terms reduce to $1\leq2$.
\item For $x<0$ the left hand side is bounded by 1, while the right hand side is still larger that 2.
\item For $1\leq x$ we have $x^2\geq x$ and the inequality holds trivially.
\item For $0< x< 1$ note that the both sides are increasing. Hence the inequality holds for all $x$ with $e^x\leq 2$. Finally, $\ln2\geq\frac{1}{2}$ and therefore the right hand side of $\ln2$ is larger then $e$.  
\end{itemize}
\end{proof}

%TODO hier gehts weiter: {x | Bed(x)} -> {Bed}

\begin{lemma}[Azema's inequality]
\[\mu(\{x\in X\mid |f(x)-\mathbb{E}(f)|\geq c\})\leq 2\exp\left(-\frac{c^2}{4\sum_{i=1}^{n}\|d_i\|^2_\infty}\right)\]
\[\mu(\{|f-\mathbb{E}(f)|\geq c\})\leq 2\exp\left(-\frac{c^2}{4\sum_{i=1}^{n}\|d_i\|^2_\infty}\right)\]
\end{lemma}

\begin{definition}\label{def:length}
Let $(X,d,\mu)$ be an mm-space.
\end{definition}
\FlorianSagt{$n$ dimensional cubes with diameter 1 have length $\frac{1}{\sqrt{3}}$ and if $|X|$ is a prime, then the length of $X$ is equal to its diameter, the length of a circle is the same as its diameter}

Between any two points in $X$ there is almost surely a path $x_0,\dots,x_n$ such that \[\sum_{i=1}^n d(x_{i-1},x_i)^2\leq \operatorname{len}(X)^2\] (this path probably has some special properties).

\begin{theorem}
If an mm-space $(X,d,\mu)$ has length $l$, then the concentration function of $X$ satisfies
\[\alpha_X(\varepsilon)\leq 2\exp\left(-\frac{\varepsilon^2}{16l^2}\right).\]
\end{theorem}


\begin{theorem}
Let $G$ be a compact group with a bi-invariant metric $d$, and let
\[\{e\}=G_0<G_1<\dots <G_n=G\]
be a chain of subgroups. Denote the diameter of $G_i/G_{i_-1}$ with respect to the factor metric by $a_i$. Then the concentration function of the mm-space $(G,d,\mu)$, where $\mu$ is the normalized Haar measure, satisfies
\[\alpha_X(\varepsilon)\leq 2\exp\left(-\frac{\varepsilon^2}{16\sum_{i=1}^{n}a_i^2}\right).\]
\end{theorem}
%rank from 2 to 3 in proof

\begin{theorem}
The normalized counting measure on the groups $\SL_{2^n}(q)$ concentrates with respect to the rank-metric, i.e. for all $r>0$
\[\lim_{n\to\infty} \alpha_{\SL_{2^n}}(r)=0 .\]
\end{theorem}

\begin{lemma}
Let $(X,d,\mu)$ be an mm-space with diameter $d$ and \FlorianSagt{could be that this only holds for finite $X$ as conditions in definition of length are just almost surely}
\[\Omega_0=\{X\}\prec\dots\prec\Omega_n=\{\{x\}\mid x\in X\}\]
with $a_1,\dots,a_n$ as in Definition \ref{def:length}. Then 
\[\sum_{i=1}^{n}a_i\geq d.\]
\end{lemma}
\begin{proof}
Let $x,y\in X$, with $x\neq y$, we show $d(x,y)\leq\sum_{i=1}^{n}a_i$. Let $i_0$ be the smallest number such that $[x]_{i_0}\neq [y]_{i_0}$. Since $[x]_0=X=[y]_0$ we know that $i_0$ is at least 1. Therefore $[x]_{i_0-1}=[y]_{i_0-1}$ and there is an isomorphism $\varphi_{i_0}\colon[x]_{i_0}\to[y]_{i_0}$ such that $d(\varphi_{i_0}(x),y)\leq a_{i_0}$.\FlorianSagt{here is the a.s. problem} Let $x_{i_0}=\varphi_{i_0}(x)$, then 
\[d(x,y)\leq d(x,x_{i_0})+d(x_{i_0},y).\]
If $x_{i_0}=y$, then we are done. Otherwise let $i_1$ be the smallest number such that $[x_{i_0}]_{i_1}\neq [y]_{i_1}$. Then let $\varphi_{i_1}\colon[x_{i_0}]_{i_1}\to[y]_{i_1}$ be an isomorphism such that $d(\varphi_{i_1}(x_{i_0}),y)\leq a_{i_1}$. Define $x_{i_1}=\varphi_{i_1}(x_{i_0})$. Proceeding in this fashion yields elements $x_{i_0},\dots,x_{i_k}$ such that $x_{i_k}=y$ and
\[d(x,y)\leq d(x,x_{i_0})+d(x_{i_0},x_{i_1})+\dots+d(x_{i_{k-1}},x_{i_k})\leq a_{i_0}+\dots +a_{i_k}\leq\sum_{i=1}^{n}a_i.\] 
\end{proof}


\begin{lemma}Why is this not the case? (it contradicts the main theorem)
\[\frac{1}{\sqrt{3}}\operatorname{diam}(X)\leq\operatorname{len}(X)\leq \operatorname{diam}(X)\]
\end{lemma}

\begin{lemma}
Let $(X,d,\mu)$ be an mm-space with diameter 1 and $\Delta=\min d$. Then the length of $X$ is at least $\Delta^{\frac{1}{2}}$.
\end{lemma}

\begin{definition}
The \define{symplectic group} of degree $2n$ over a field $q$, denoted by $\Sp(2n,q)$, is the subgroup of $\SL(2n,q)$ containing all matrices $A$ such that
\[A^T\Omega A=\Omega,\ \text{where}\ \Omega=\left(\begin{array}{cc}
0&E_n\\
-E_n&0
\end{array}\right).\]
\end{definition}

\begin{lemma}
%d(A0,A0)
% (CD 0I)
Let $g\colon V\to V$ be an isomorphism, $V=U\oplus U'$, and $g(U')\subseteq U'$. %it follows g(U')=U'
Then the map 
\begin{align*}
g'\colon V&\to V\\
v&\mapsto
\begin{cases}
g(v)-\pi_{U'}(g(v)) &\text{if }v\notin U'\\
v &\text{if }v\in U'
\end{cases}
\end{align*}
i.e. $g'=\pi_U\circ g-\pi_U\circ g \circ1_{U'} +1_{U'}$, is an isomorphism and $d(g,g')\leq \frac{1}{n}\cdot\dim U'$.
\end{lemma}


\begin{lemma}\label{lem:extend}[what we still need (add conditions for $\omega$ if necessary)]
Let $\omega\colon V\times V\to k$ be a bilinear map, $U,U'$ subspaces of $V$, and $h\colon U\to U'$ an isomorphism that preserves $\omega$. Then $h$ can be extended to an isomorphism on $V$ which also preserves $\omega$.
\end{lemma}
\begin{proof}
w.l.o.g. $\dim U+1= \dim V$ ?
\end{proof}


\begin{lemma}
Let $V=U\oplus U'$, $\omega$ a bilinear\FlorianSagt{\dots additional conditions} map, $G$ be the group of automorphisms of $(V,\omega)$ and $G'\leq G$ the subgroup fixing $U'$. Then the diameter of $G/G_i$ is at most $\frac{3\cdot\dim U'}{n}$\FlorianSagt{adapt this}.
\end{lemma}
\begin{proof}
Let $g\in G$, we show that there are $g'\in G$ and $g''\in G'$ such that $g'(U')\subseteq U'$, $g'|_{U'}=1_{U'}$, and
\[d(g,g'')\leq d(g,g')+d(g',g'')\leq \frac{2\dim U'}{n}+\frac{\dim U'}{n}.\]

By Lemma \ref{lem:extend} we can extend the map $g^{-1}|_{gU'}$ to a map $h'$ on $V'=\langle U',gU' \rangle$. Now define $g'=(1_{V''}\oplus h')g$, where $V=V''\oplus V'$ and apply Lemma to $g'$ to obtain $g''$.
\begin{align*}
\im g-g'&= \im g-(1_{V''}\oplus h')g\\
&=\im (1_{V''}\oplus 1_{V'}-1_{V''}\oplus h')\\
&=\im (1_{V'}-h')\\
&\subseteq V'	
\end{align*}
\begin{align*}
d(g,g')=\frac{1}{n}\dim \operatorname{im} g-g'\leq \frac{\dim V'}{n}
\end{align*}
\end{proof}

\section{The limit of $\SL_n(q)$ is extremely amenable}